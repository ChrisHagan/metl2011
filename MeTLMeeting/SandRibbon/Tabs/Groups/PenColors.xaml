<UserControl x:Class="SandRibbon.Tabs.Groups.PenColors"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:sr="clr-namespace:Divelements.SandRibbon;assembly=Divelements.SandRibbon"
    xmlns:api="clr-namespace:SandRibbon;assembly=SandRibbonInterop"
    xmlns:my="clr-namespace:SandRibbon"
    xmlns:groups="clr-namespace:SandRibbon.Tabs.Groups"
    xmlns:SandRibbonInterop="clr-namespace:SandRibbonInterop;assembly=SandRibbonInterop"
    xmlns:core="clr-namespace:System;assembly=mscorlib">
    <StackPanel x:Name="LayoutRoot" Orientation="Horizontal">
        <StackPanel.Resources>
            <groups:AttributesToStringConverter x:Key="AttributesToStringConverter"/>
            <groups:IntTextConverter x:Key="IntTextConverter"/>
            <groups:HueTextConverter x:Key="HueSliderTextConverter"/>
            <groups:DoubleTextConverter x:Key="DoubleSliderTextConverter"/>
            <groups:RoundingConverter x:Key="RoundingConverter"/>
            <groups:HueSliderConverter x:Key="HueSliderConverter"/>
            <groups:DoubleSliderConverter x:Key="DoubleSliderConverter"/>
            <groups:ReverseBoolToVisibilityConverter x:Key="reverseBoolToVisibilityConverter"/>
            <groups:BoolToVisibilityConverter x:Key="boolToVisibilityConverter"/>
            <groups:HexToColourConverter x:Key="HexToColourConverter"/>
            <groups:colourContrastConverter x:Key="colourContrastConverter"/>
            <my:availablePenTitleConverter x:Key="myAvailablePenTitleConverter"/>
            <my:availablePenDropDownConverter x:Key="myAvailablePenDropDownConverter"/>
            <ImageBrush ImageSource="\Resources\Ribbon-Palette.png" x:Key="SpectrumBrush"/>
            <LinearGradientBrush x:Key="BrushGradientBackground" StartPoint="0,0" EndPoint="1,0" MappingMode="RelativeToBoundingBox">
                <LinearGradientBrush.GradientStops>
                    <GradientStop Color="White" Offset="0"/>
                    <GradientStop Color="Transparent" Offset="1"/>
                </LinearGradientBrush.GradientStops>
            </LinearGradientBrush>
            <DrawingBrush x:Key="CheckerboardBackground" Viewport="0,0,.25,.25" TileMode="Tile" Stretch="None">
                <DrawingBrush.Drawing>
                    <DrawingGroup>
                        <DrawingGroup.Children>
                            <GeometryDrawing Brush="DarkGray" Geometry="F1 M 0,0 5,0 5,10 10,10 10,5 0,5 0,0  Z"/>
                        </DrawingGroup.Children>
                    </DrawingGroup>
                </DrawingBrush.Drawing>
            </DrawingBrush>
        </StackPanel.Resources>
        <SandRibbonInterop:RibbonPanel>
            <SandRibbonInterop:RadioButton x:Name="Draw" Visibility="Collapsed" ToolTip="{StaticResource PenToolTip}" Icon="\Resources\Inking.png" Text="Draw" Command="api:Commands.SetInkCanvasMode" CommandParameter="Ink" IsChecked="True"/>
            <SandRibbonInterop:RadioButton ToolTip="{StaticResource SelectToolTip}"  Icon="\Resources\SelectInk.png" Text="Select" Command="api:Commands.SetInkCanvasMode" CommandParameter="Select" />
            <SandRibbonInterop:RadioButton ToolTip="{StaticResource EraserToolTip}" Icon="\Resources\ShinyEraser.png" Text="Erase" Command="api:Commands.SetInkCanvasMode" CommandParameter="EraseByStroke"/>
        </SandRibbonInterop:RibbonPanel>
        <Button x:Name="hiddenButton" Visibility="Collapsed" Command="api:Commands.DummyCommandToProcessCanExecute" Tag="This button should always be collapsed.  It is only being used to redirect a canExecute Handler."/>
        <ListBox x:Name="defaultColours" SelectionChanged="ChangeColorFromPreset" Background="Transparent" IsEnabled="{Binding ElementName=hiddenButton, Path=IsEnabled}"
                 ScrollViewer.VerticalScrollBarVisibility="Disabled" ScrollViewer.HorizontalScrollBarVisibility="Disabled" BorderThickness="0" Padding="0" BorderBrush="Transparent">
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Tag="{Binding Path=Index}"
                            Padding="2" BorderBrush="Transparent" Name="buttonBorder" BorderThickness="1" Height="62" Width="50">
                        <Border.ToolTip>
                            <ToolTip>
                                <Border Background="{StaticResource BackgroundBlueGradient}" BorderBrush="DarkGray" BorderThickness="1">
                                    <Grid Margin="2">
                                        <TextBlock Margin="30,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Top" 
                           Text="{Binding Path=IsHighlighter, Converter={StaticResource myAvailablePenTitleConverter}}" FontSize="14" FontWeight="Bold"/>
                                    </Grid>
                                </Border>
                            </ToolTip>
                        </Border.ToolTip>
                        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Height="Auto" Width="Auto">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40"/>
                                <RowDefinition Height="25"/>
                            </Grid.RowDefinitions>
                            <Rectangle Grid.Row="0" Fill="{StaticResource CheckerboardBackground}"/>
                            <Rectangle Grid.Row="0" Grid.RowSpan="2" Fill="{StaticResource BrushGradientBackground}"/>
                            <Border BorderThickness="0" Padding="0" Grid.Row="0" ClipToBounds="True">
                                <Grid>
                                    <InkPresenter 
                                                      Strokes="{Binding Path=BrushPreviewStroke}"/>
                                    <InkPresenter 
                                                      Strokes="{Binding Path=HighlighterPreviewStroke}"
                                                      Visibility="{Binding Path=IsHighlighter, Converter={StaticResource boolToVisibilityConverter}}" />
                                </Grid>
                            </Border>
                            <Button Margin="0" HorizontalAlignment="Stretch" Width="Auto" Grid.Row="1" x:Name="OpenPopup" Click="OpenColourSettingPopup" Tag="{Binding Path=Index}">
                                <Button.ToolTip>
                                    <ToolTip>
                                        <Border Background="{StaticResource BackgroundBlueGradient}" BorderBrush="DarkGray" BorderThickness="1">
                                            <Grid Margin="2">
                                                <TextBlock Margin="0,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Top" 
                           Text="{Binding Path=IsHighlighter, Converter={StaticResource myAvailablePenDropDownConverter}}" FontSize="14" FontWeight="Bold"/>
                                                <TextBlock Margin="0,30,0,0" TextWrapping="Wrap" 
                           Text="Change the colour or thickness of this pen."/>
                                            </Grid>
                                        </Border>
                                    </ToolTip>
                                </Button.ToolTip>
                                <Polygon Stroke="DarkGray" Fill="LightGray" Points="0,0 10,0 5,5 0,0"/>
                            </Button>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        <Popup x:Name="ColourSettingPopup" Placement="Bottom" StaysOpen="False" AllowsTransparency="True" PopupAnimation="Fade">
            <Border Height="300" Width="250" BorderThickness="1" BorderBrush="LightGray" CornerRadius="2" Padding="2" Background="{StaticResource BackgroundBlueGradient}">
                <StackPanel>
                    <Label Content="Change the colour"/>
                    <ListBox x:Name="ColourChooser" Height="160" 
                             Background="Transparent"
                             SelectionChanged="ChangeColour">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Rows="4" Columns="6" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid PreviewMouseUp="ColourUp"
                                      HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                        Width="Auto" Height="Auto" Background="Transparent">
                                    <Rectangle Fill="{Binding}" Margin="3" IsHitTestVisible="False"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <Label Content="Change the size"/>
                    <ListBox x:Name="SizeChooser" Height="40"
                             Background="Transparent" 
                             SelectionChanged="ChangeSize">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Rows="1"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid PreviewMouseUp="SizeUp"
                                    HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                        Width="Auto" Height="Auto" Background="Transparent">
                                    <Rectangle Margin="2"
                                    Fill="Black" IsHitTestVisible="False" 
                                    StrokeThickness="1" Width="Auto"  
                                    Stroke="Black" HorizontalAlignment="Stretch" 
                                    VerticalAlignment="Center" Height="{Binding}"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <Button Click="ResetToDefault">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <Rectangle Width="25" Height="20" x:Name="ColourSettingPopupDefaultColour"/>
                            <Label Content="Reset pen to default settings" FontWeight="Regular" FontSize="11"/>
                            <Rectangle Width="25" Fill="Black" x:Name="ColourSettingPopupDefaultSize"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Border>
        </Popup>
    </StackPanel>
</UserControl>
